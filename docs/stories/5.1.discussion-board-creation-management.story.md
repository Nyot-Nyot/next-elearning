# Story 5.1: Discussion Board Creation and Management

## Status
Draft

## Story
**As a** lecturer,
**I want to** create and manage discussion topics for my course,
**so that** I can facilitate meaningful class discussions and moderate course conversations

## Acceptance Criteria
1. Lecturer can create discussion threads with titles and descriptions
2. Discussion threads can be pinned or organized by categories
3. Lecturer can moderate discussions (delete inappropriate posts)
4. Thread status can be set (open, closed, archived)
5. Discussion settings can control who can post

## Tasks / Subtasks
- [ ] Build discussion thread creation system (AC: 1)
  - [ ] Create discussion thread creation form with title and description
  - [ ] Implement rich text editor for thread descriptions
  - [ ] Add thread categorization and tagging system
  - [ ] Create thread templates for common discussion types
  - [ ] Build thread scheduling for future publication
- [ ] Implement discussion organization features (AC: 2)
  - [ ] Create thread pinning functionality for important discussions
  - [ ] Build category system for organizing discussions by topic
  - [ ] Add thread sorting options (newest, popular, activity)
  - [ ] Implement thread search and filtering capabilities
  - [ ] Create discussion board overview with category navigation
- [ ] Add moderation and management tools (AC: 3)
  - [ ] Build post moderation interface for lecturers
  - [ ] Implement post deletion and editing controls
  - [ ] Add user reporting system for inappropriate content
  - [ ] Create moderation history and audit trail
  - [ ] Build bulk moderation actions for multiple posts
- [ ] Create thread status management (AC: 4)
  - [ ] Implement thread status controls (open, closed, archived)
  - [ ] Add automatic thread closing based on rules
  - [ ] Create thread archiving system for old discussions
  - [ ] Build thread restoration capabilities
  - [ ] Add status change notifications to participants
- [ ] Build discussion access controls (AC: 5)
  - [ ] Create posting permission settings per thread
  - [ ] Implement role-based discussion access (students, TAs, lecturers)
  - [ ] Add anonymous posting options where appropriate
  - [ ] Build discussion visibility controls (public, course-only, private)
  - [ ] Create user blocking and restriction features
- [ ] Optimize discussion system for free tier (AC: 1-5)
  - [ ] Implement efficient thread loading with pagination
  - [ ] Cache popular discussions to reduce database load
  - [ ] Optimize search functionality for large discussions
  - [ ] Create discussion cleanup for old archived threads
  - [ ] Add discussion analytics for engagement tracking

## Dev Notes

### Previous Story Context
This story initiates Epic 5 and builds on the complete LMS foundation:
- **Epic 1 (1.1-1.3)**: User authentication and role management system
- **Epic 2 (2.1-2.3)**: Complete course creation and management system
- **Epic 3 (3.1-3.3)**: Student dashboard with progress tracking and calendar
- **Epic 4 (4.1-4.3)**: Full assignment workflow with grading and feedback
- **Dependencies**: Requires course enrollment, user roles, and notification system

### Technical Stack Context - Free Tier Optimized
[Source: docs/prd/technical-stack.md]
- **Frontend**: Next.js, Tailwind CSS (discussion interface and rich text editing)
- **Backend**: Supabase (Free Tier - 500MB database, 2GB bandwidth)
- **Database**: PostgreSQL via Supabase for discussion threads and posts
- **File Storage**: Supabase Storage (1GB total - optimized for discussion attachments)
- **Real-time**: Supabase Realtime for live discussion updates
- **Hosting**: Vercel (Free Tier)

### Data Models Extension
Extended database schema for discussion boards:
```sql
-- Discussion categories for organizing threads
CREATE TABLE discussion_categories (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  course_id UUID REFERENCES courses(id) ON DELETE CASCADE,
  category_name VARCHAR(100) NOT NULL,
  description TEXT,
  color_code VARCHAR(7) DEFAULT '#3B82F6', -- Hex color for category
  is_default BOOLEAN DEFAULT false,
  display_order INTEGER DEFAULT 0,
  created_by UUID REFERENCES users(id) ON DELETE SET NULL,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- Discussion threads/topics
CREATE TABLE discussion_threads (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  course_id UUID REFERENCES courses(id) ON DELETE CASCADE,
  category_id UUID REFERENCES discussion_categories(id) ON DELETE SET NULL,
  thread_title VARCHAR(255) NOT NULL,
  thread_description TEXT,
  thread_type VARCHAR(20) DEFAULT 'general', -- 'general', 'qa', 'announcement', 'assignment'
  status VARCHAR(20) DEFAULT 'open', -- 'open', 'closed', 'archived'
  is_pinned BOOLEAN DEFAULT false,
  is_locked BOOLEAN DEFAULT false,
  allows_anonymous BOOLEAN DEFAULT false,
  post_permissions VARCHAR(20) DEFAULT 'enrolled', -- 'enrolled', 'instructors', 'custom'
  view_count INTEGER DEFAULT 0,
  post_count INTEGER DEFAULT 0,
  last_activity TIMESTAMP DEFAULT NOW(),
  last_post_id UUID REFERENCES discussion_posts(id),
  created_by UUID REFERENCES users(id) ON DELETE SET NULL,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),
  
  -- Full-text search for threads
  search_vector tsvector GENERATED ALWAYS AS (
    to_tsvector('english', COALESCE(thread_title, '') || ' ' || COALESCE(thread_description, ''))
  ) STORED
);

-- Discussion posts and replies
CREATE TABLE discussion_posts (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  thread_id UUID REFERENCES discussion_threads(id) ON DELETE CASCADE,
  parent_post_id UUID REFERENCES discussion_posts(id) ON DELETE CASCADE, -- NULL for top-level posts
  author_id UUID REFERENCES users(id) ON DELETE SET NULL,
  content TEXT NOT NULL,
  content_html TEXT, -- Rendered HTML version of content
  is_anonymous BOOLEAN DEFAULT false,
  is_edited BOOLEAN DEFAULT false,
  is_deleted BOOLEAN DEFAULT false,
  is_solution BOOLEAN DEFAULT false, -- Mark as solution for Q&A threads
  edited_at TIMESTAMP,
  deleted_at TIMESTAMP,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),
  
  -- Full-text search for posts
  search_vector tsvector GENERATED ALWAYS AS (
    to_tsvector('english', COALESCE(content, ''))
  ) STORED
);

-- Post reactions and engagement
CREATE TABLE post_reactions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  post_id UUID REFERENCES discussion_posts(id) ON DELETE CASCADE,
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  reaction_type VARCHAR(20) NOT NULL, -- 'like', 'helpful', 'insightful', 'funny'
  created_at TIMESTAMP DEFAULT NOW(),
  UNIQUE(post_id, user_id, reaction_type)
);

-- Discussion subscriptions for notifications
CREATE TABLE discussion_subscriptions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  thread_id UUID REFERENCES discussion_threads(id) ON DELETE CASCADE,
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  subscription_type VARCHAR(20) DEFAULT 'all', -- 'all', 'replies_only', 'mentions_only'
  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),
  UNIQUE(thread_id, user_id)
);

-- Discussion moderation actions
CREATE TABLE discussion_moderation (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  post_id UUID REFERENCES discussion_posts(id) ON DELETE CASCADE,
  thread_id UUID REFERENCES discussion_threads(id) ON DELETE CASCADE,
  moderator_id UUID REFERENCES users(id) ON DELETE SET NULL,
  action_type VARCHAR(20) NOT NULL, -- 'delete', 'edit', 'lock', 'pin', 'move'
  reason TEXT,
  previous_content TEXT, -- Store original content for deleted/edited posts
  action_data JSONB DEFAULT '{}', -- Additional action metadata
  created_at TIMESTAMP DEFAULT NOW()
);

-- Discussion attachments and files
CREATE TABLE discussion_attachments (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  post_id UUID REFERENCES discussion_posts(id) ON DELETE CASCADE,
  original_filename VARCHAR(255) NOT NULL,
  stored_filename VARCHAR(255) NOT NULL,
  file_path VARCHAR(500) NOT NULL,
  file_size_bytes BIGINT NOT NULL,
  file_type VARCHAR(100) NOT NULL,
  mime_type VARCHAR(100) NOT NULL,
  uploaded_at TIMESTAMP DEFAULT NOW()
);

-- Discussion settings per course
CREATE TABLE discussion_settings (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  course_id UUID REFERENCES courses(id) ON DELETE CASCADE,
  allow_student_threads BOOLEAN DEFAULT true,
  require_moderation BOOLEAN DEFAULT false,
  allow_anonymous_posts BOOLEAN DEFAULT false,
  allow_file_attachments BOOLEAN DEFAULT true,
  max_attachment_size_mb INTEGER DEFAULT 5,
  auto_subscribe_instructors BOOLEAN DEFAULT true,
  email_notifications BOOLEAN DEFAULT true,
  settings_data JSONB DEFAULT '{}', -- Additional settings
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),
  UNIQUE(course_id)
);

-- Discussion tags for enhanced organization
CREATE TABLE discussion_tags (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  course_id UUID REFERENCES courses(id) ON DELETE CASCADE,
  tag_name VARCHAR(50) NOT NULL,
  tag_color VARCHAR(7) DEFAULT '#6B7280',
  usage_count INTEGER DEFAULT 0,
  created_at TIMESTAMP DEFAULT NOW(),
  UNIQUE(course_id, tag_name)
);

-- Thread-tag relationships
CREATE TABLE thread_tags (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  thread_id UUID REFERENCES discussion_threads(id) ON DELETE CASCADE,
  tag_id UUID REFERENCES discussion_tags(id) ON DELETE CASCADE,
  created_at TIMESTAMP DEFAULT NOW(),
  UNIQUE(thread_id, tag_id)
);
```

### File Locations
Based on Next.js conventions and discussion board system:
- Discussion pages: `pages/courses/[courseId]/discussions/` or `app/courses/[courseId]/discussions/`
- Discussion home: `pages/courses/[courseId]/discussions/index.js` or `app/courses/[courseId]/discussions/page.js`
- Thread view: `pages/courses/[courseId]/discussions/[threadId].js` or `app/courses/[courseId]/discussions/[threadId]/page.js`
- Create thread: `pages/courses/[courseId]/discussions/create.js` or `app/courses/[courseId]/discussions/create/page.js`
- Discussion components: `components/discussions/DiscussionBoard.js`, `components/discussions/ThreadList.js`
- Thread components: `components/discussions/ThreadView.js`, `components/discussions/PostEditor.js`
- Moderation components: `components/discussions/ModerationPanel.js`, `components/discussions/PostActions.js`
- Discussion utilities: `lib/discussionHelpers.js`, `lib/moderationUtils.js`
- Discussion hooks: `hooks/useDiscussions.js`, `hooks/useModeration.js`

### Free Tier Discussion Optimization
**Efficient Discussion Strategy:**
```javascript
// Optimized discussion system for free tier
const DiscussionOptimization = {
  // Thread and post loading optimization
  loadingOptimization: {
    threadsPerPage: 20, // Paginate thread list
    postsPerPage: 25, // Paginate posts within threads
    preloadDepth: 2, // Preload 2 levels of replies
    cacheThreads: 50, // Cache last 50 viewed threads
    virtualScrolling: true // Use virtual scrolling for long discussions
  },
  
  // Search and filtering optimization
  searchOptimization: {
    indexedSearch: true, // Use PostgreSQL full-text search
    searchDebounce: 500, // 500ms debounce for search queries
    resultLimit: 100, // Limit search results
    searchCache: 24 * 60 * 60 * 1000, // Cache search results for 24 hours
    popularThreadsCache: true // Cache popular threads separately
  },
  
  // File attachment optimization
  attachmentOptimization: {
    maxFileSize: 5, // 5MB max per attachment
    allowedTypes: ['.pdf', '.doc', '.docx', '.txt', '.jpg', '.png'],
    imageCompression: 80, // 80% quality for images
    thumbnailGeneration: true, // Generate thumbnails for images
    totalDiscussionStorage: 200 // 200MB total for all discussion attachments
  },
  
  // Real-time update optimization
  realtimeOptimization: {
    subscriptionLimit: 10, // Max 10 active thread subscriptions
    updateBatching: 2000, // Batch updates every 2 seconds
    presenceIndicators: true, // Show who's viewing thread
    typingIndicators: false, // Disable typing indicators for performance
    heartbeatInterval: 30000 // 30 second heartbeat
  }
};
```

### Discussion Board Interface Design
```jsx
// Comprehensive discussion board system interface
const DiscussionBoard = () => {
  const [selectedCategory, setSelectedCategory] = useState(null);
  const [threads, setThreads] = useState([]);
  const [searchQuery, setSearchQuery] = useState('');
  const [sortBy, setSortBy] = useState('last_activity');

  return (
    <DiscussionContainer>
      <DiscussionHeader>
        <DiscussionTitle>Course Discussions</DiscussionTitle>
        <DiscussionActions>
          <SearchDiscussions 
            query={searchQuery}
            onSearch={setSearchQuery}
          />
          <CreateThreadButton />
          <DiscussionSettings />
        </DiscussionActions>
      </DiscussionHeader>
      
      <DiscussionSidebar>
        <CategoryList 
          categories={discussionCategories}
          selectedCategory={selectedCategory}
          onCategorySelect={setSelectedCategory}
        />
        <DiscussionStats stats={discussionStats} />
        <PopularThreads threads={popularThreads} />
      </DiscussionSidebar>
      
      <DiscussionMainArea>
        <DiscussionFilters>
          <ThreadSorting 
            sortBy={sortBy}
            onSortChange={setSortBy}
          />
          <ThreadFilters 
            filters={activeFilters}
            onFilterChange={handleFilterChange}
          />
        </DiscussionFilters>
        
        <ThreadsList 
          threads={filteredThreads}
          onThreadSelect={handleThreadSelect}
        />
        
        <DiscussionPagination 
          currentPage={currentPage}
          totalPages={totalPages}
          onPageChange={setCurrentPage}
        />
      </DiscussionMainArea>
      
      {isLecturer && (
        <ModerationPanel>
          <ModerationActions />
          <RecentModerationActivity />
          <ReportedPosts />
        </ModerationPanel>
      )}
    </DiscussionContainer>
  );
};
```

### Thread Creation and Management
**Discussion Thread Features:**
```javascript
// Discussion thread creation and management
const ThreadManagement = {
  // Thread creation
  threadCreation: {
    createThread: async (courseId, threadData, authorId) => {
      // Create the discussion thread
      const { data: thread } = await supabase
        .from('discussion_threads')
        .insert({
          course_id: courseId,
          category_id: threadData.categoryId,
          thread_title: threadData.title,
          thread_description: threadData.description,
          thread_type: threadData.type || 'general',
          allows_anonymous: threadData.allowsAnonymous || false,
          post_permissions: threadData.postPermissions || 'enrolled',
          created_by: authorId
        })
        .select()
        .single();
      
      // Add tags if provided
      if (threadData.tags && threadData.tags.length > 0) {
        await addThreadTags(thread.id, threadData.tags);
      }
      
      // Auto-subscribe creator to thread
      await supabase
        .from('discussion_subscriptions')
        .insert({
          thread_id: thread.id,
          user_id: authorId,
          subscription_type: 'all'
        });
      
      return thread;
    },
    
    updateThread: async (threadId, updates, moderatorId) => {
      // Check if user has permission to edit
      const canEdit = await checkThreadEditPermission(threadId, moderatorId);
      if (!canEdit) {
        throw new Error('Insufficient permissions to edit thread');
      }
      
      // Update thread
      const { data: thread } = await supabase
        .from('discussion_threads')
        .update({
          ...updates,
          updated_at: new Date()
        })
        .eq('id', threadId)
        .select()
        .single();
      
      // Log moderation action
      await logModerationAction(threadId, moderatorId, 'edit', 'Thread updated');
      
      return thread;
    }
  },
  
  // Thread organization
  threadOrganization: {
    pinThread: async (threadId, moderatorId) => {
      await supabase
        .from('discussion_threads')
        .update({
          is_pinned: true,
          updated_at: new Date()
        })
        .eq('id', threadId);
      
      await logModerationAction(threadId, moderatorId, 'pin', 'Thread pinned');
    },
    
    categorizeThread: async (threadId, categoryId, moderatorId) => {
      await supabase
        .from('discussion_threads')
        .update({
          category_id: categoryId,
          updated_at: new Date()
        })
        .eq('id', threadId);
      
      await logModerationAction(threadId, moderatorId, 'move', `Moved to category ${categoryId}`);
    },
    
    addThreadTags: async (threadId, tags) => {
      // Create tags if they don't exist
      for (const tagName of tags) {
        await supabase
          .from('discussion_tags')
          .upsert({
            course_id: courseId,
            tag_name: tagName.toLowerCase().trim()
          });
      }
      
      // Get tag IDs
      const { data: tagData } = await supabase
        .from('discussion_tags')
        .select('id, tag_name')
        .in('tag_name', tags);
      
      // Link tags to thread
      const threadTags = tagData.map(tag => ({
        thread_id: threadId,
        tag_id: tag.id
      }));
      
      await supabase
        .from('thread_tags')
        .insert(threadTags);
    }
  },
  
  // Thread status management
  statusManagement: {
    closeThread: async (threadId, moderatorId, reason) => {
      await supabase
        .from('discussion_threads')
        .update({
          status: 'closed',
          is_locked: true,
          updated_at: new Date()
        })
        .eq('id', threadId);
      
      await logModerationAction(threadId, moderatorId, 'lock', reason);
      
      // Notify subscribers
      await notifyThreadStatusChange(threadId, 'closed');
    },
    
    archiveThread: async (threadId, moderatorId) => {
      await supabase
        .from('discussion_threads')
        .update({
          status: 'archived',
          updated_at: new Date()
        })
        .eq('id', threadId);
      
      await logModerationAction(threadId, moderatorId, 'archive', 'Thread archived');
    },
    
    reopenThread: async (threadId, moderatorId) => {
      await supabase
        .from('discussion_threads')
        .update({
          status: 'open',
          is_locked: false,
          updated_at: new Date()
        })
        .eq('id', threadId);
      
      await logModerationAction(threadId, moderatorId, 'reopen', 'Thread reopened');
    }
  }
};
```

### Moderation System
**Discussion Moderation Tools:**
```javascript
// Discussion moderation system
const ModerationSystem = {
  // Post moderation
  postModeration: {
    deletePost: async (postId, moderatorId, reason) => {
      // Get original post content for audit trail
      const { data: post } = await supabase
        .from('discussion_posts')
        .select('content, author_id, thread_id')
        .eq('id', postId)
        .single();
      
      // Soft delete the post
      await supabase
        .from('discussion_posts')
        .update({
          is_deleted: true,
          content: '[Post deleted by moderator]',
          deleted_at: new Date()
        })
        .eq('id', postId);
      
      // Log moderation action
      await supabase
        .from('discussion_moderation')
        .insert({
          post_id: postId,
          thread_id: post.thread_id,
          moderator_id: moderatorId,
          action_type: 'delete',
          reason: reason,
          previous_content: post.content
        });
      
      // Update thread post count
      await updateThreadPostCount(post.thread_id);
      
      // Notify post author
      await notifyModerationAction(post.author_id, 'post_deleted', reason);
    },
    
    editPost: async (postId, newContent, moderatorId, reason) => {
      const { data: post } = await supabase
        .from('discussion_posts')
        .select('content, thread_id')
        .eq('id', postId)
        .single();
      
      await supabase
        .from('discussion_posts')
        .update({
          content: newContent,
          is_edited: true,
          edited_at: new Date()
        })
        .eq('id', postId);
      
      await supabase
        .from('discussion_moderation')
        .insert({
          post_id: postId,
          thread_id: post.thread_id,
          moderator_id: moderatorId,
          action_type: 'edit',
          reason: reason,
          previous_content: post.content
        });
    }
  },
  
  // User management
  userManagement: {
    blockUserFromThread: async (userId, threadId, moderatorId, reason) => {
      // Add user to thread block list (would need additional table)
      await supabase
        .from('discussion_moderation')
        .insert({
          thread_id: threadId,
          moderator_id: moderatorId,
          action_type: 'user_block',
          reason: reason,
          action_data: { blocked_user_id: userId }
        });
      
      await notifyModerationAction(userId, 'thread_blocked', reason);
    },
    
    restrictUserPosting: async (userId, courseId, moderatorId, duration) => {
      // Implement posting restrictions (would need additional logic)
      const restrictionEnd = new Date();
      restrictionEnd.setHours(restrictionEnd.getHours() + duration);
      
      await logModerationAction(null, moderatorId, 'user_restrict', 
        `User ${userId} restricted from posting until ${restrictionEnd}`);
    }
  },
  
  // Moderation workflow
  moderationWorkflow: {
    reviewReportedPost: async (postId, moderatorId, action) => {
      const actions = {
        'approve': async () => {
          await clearPostReports(postId);
        },
        'delete': async () => {
          await this.postModeration.deletePost(postId, moderatorId, 'Reported content violated community guidelines');
        },
        'edit': async (newContent) => {
          await this.postModeration.editPost(postId, newContent, moderatorId, 'Content modified due to reports');
        }
      };
      
      if (actions[action]) {
        await actions[action]();
      }
    },
    
    getModerationQueue: async (courseId) => {
      return await supabase
        .from('discussion_posts')
        .select(`
          *,
          discussion_threads(thread_title, course_id),
          users(username, email)
        `)
        .eq('discussion_threads.course_id', courseId)
        .eq('requires_moderation', true)
        .order('created_at', { ascending: true });
    }
  }
};
```

### Discussion Analytics
**Engagement Tracking:**
```javascript
// Discussion analytics and engagement tracking
const DiscussionAnalytics = {
  // Thread analytics
  threadAnalytics: {
    trackThreadView: async (threadId, userId) => {
      // Increment view count
      await supabase
        .from('discussion_threads')
        .update({
          view_count: supabase.raw('view_count + 1'),
          last_activity: new Date()
        })
        .eq('id', threadId);
      
      // Track user engagement for XP
      await trackUserEngagement(userId, 'thread_view', 5);
    },
    
    calculateThreadPopularity: async (threadId) => {
      const { data } = await supabase
        .from('discussion_posts')
        .select('post_reactions(count)')
        .eq('thread_id', threadId);
      
      const totalReactions = data.reduce((sum, post) => 
        sum + (post.post_reactions[0]?.count || 0), 0);
      
      return {
        postCount: data.length,
        reactionCount: totalReactions,
        popularityScore: (data.length * 2) + totalReactions
      };
    }
  },
  
  // User engagement analytics
  userEngagement: {
    trackPostCreation: async (userId, postId) => {
      await trackUserEngagement(userId, 'discussion_post', 20);
      
      // Check for discussion achievements
      await checkDiscussionAchievements(userId);
    },
    
    awardDiscussionXP: async (userId, action, points) => {
      await supabase
        .from('user_progress')
        .upsert({
          user_id: userId,
          discussion_xp: supabase.raw(`discussion_xp + ${points}`),
          total_xp: supabase.raw(`total_xp + ${points}`),
          updated_at: new Date()
        });
    }
  }
};
```

### Mobile Discussion Experience
**Touch-Optimized Discussion Interface:**
- **Mobile Thread View**: Optimized thread reading with touch-friendly navigation
- **Mobile Posting**: Simple post creation interface for mobile devices
- **Swipe Gestures**: Swipe to reply, react, or moderate posts
- **Offline Reading**: Cache discussions for offline reading
- **Push Notifications**: Mobile notifications for replies and mentions

### Integration with Previous Systems
**Building on Complete LMS Foundation:**
```javascript
// Integration with existing LMS systems
const DiscussionIntegration = {
  // Course integration (Epic 2)
  courseIntegration: {
    autoCreateDiscussions: true, // Auto-create discussion categories for new courses
    courseEnrollmentCheck: true, // Only enrolled users can participate
    instructorPermissions: true, // Automatic moderation rights for instructors
    courseCompletionTracking: true // Discussion participation affects course completion
  },
  
  // Assignment integration (Epic 4)
  assignmentIntegration: {
    assignmentDiscussions: true, // Auto-create discussion threads for assignments
    submissionQuestions: true, // Q&A threads for assignment help
    peerReview: false, // Save for future enhancements
    gradingDiscussion: false // Keep grading separate from discussions
  },
  
  // Progress tracking integration (Epic 3)
  progressIntegration: {
    discussionParticipation: {
      trackEngagement: true,
      updateXP: true,
      participationMetrics: true,
      helpfulnessScore: true
    },
    
    achievements: [
      'First Post',
      'Helpful Contributor',
      'Discussion Leader',
      'Problem Solver'
    ]
  }
};
```

### Security and Privacy
**Discussion Security Measures:**
```javascript
// Security considerations for discussion system
const DiscussionSecurity = {
  // Access control
  accessControl: {
    courseEnrollmentRequired: true,
    roleBasedPermissions: true,
    threadPermissions: true,
    anonymousPostingControls: true
  },
  
  // Content protection
  contentProtection: {
    inputSanitization: true,
    htmlFiltering: true,
    linkValidation: true,
    fileUploadSecurity: true
  },
  
  // Privacy measures
  privacyMeasures: {
    anonymousPosting: true,
    postDeletion: true,
    dataRetention: '2_years',
    userBlockingSystem: true
  }
};
```

### Performance Optimizations
**Free Tier Discussion Performance:**
- **Efficient Loading**: Paginated threads and posts with virtual scrolling
- **Smart Caching**: Cache popular discussions and search results
- **Optimized Search**: PostgreSQL full-text search with indexed content
- **File Management**: Compressed attachments with size limits
- **Real-time Updates**: Batched updates to reduce database load

### Testing Requirements
Discussion board system requires comprehensive testing:
- **Thread Tests**: Creation, editing, status management, and organization
- **Post Tests**: Creating, editing, deleting, and moderating posts
- **Moderation Tests**: All moderation actions and permission checks
- **Search Tests**: Full-text search functionality and performance
- **Integration Tests**: Course enrollment, user roles, and notification system

## Testing

### Testing Standards
Discussion board creation and management testing strategy:
- **Unit Tests**:
  - Thread management logic (`lib/discussionHelpers.test.js`)
  - Moderation utilities (`lib/moderationUtils.test.js`)
  - Search functionality (`lib/discussionSearch.test.js`)
  - Permission system (`lib/discussionPermissions.test.js`)
- **Component Tests**:
  - Thread creation and editing forms
  - Discussion board navigation and filtering
  - Moderation panel and actions
  - Category and tag management
- **Integration Tests**:
  - Complete discussion workflow (`api/discussions.test.js`)
  - Thread creation to post interaction
  - Moderation actions and permission checks
  - Course integration and enrollment verification
- **E2E Tests**:
  - Full discussion board user journey
  - Lecturer moderation workflow testing
  - Cross-browser discussion interface testing
  - Mobile discussion board functionality
- **Performance Tests**:
  - Thread loading performance with large datasets
  - Search performance across multiple discussions
  - Real-time update performance
  - File attachment upload and management

Test file locations:
- `__tests__/discussions/discussionWorkflow.test.js`
- `__tests__/api/discussionsApi.test.js`
- `__tests__/e2e/discussionBoard.test.js`
- `__tests__/components/discussionComponents.test.js`
- `__tests__/moderation/moderationSystem.test.js`

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-07-21 | 1.0 | Initial discussion board creation and management story | Scrum Master (Bob) |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

### Agent Model Used
*To be filled by dev agent*

### Debug Log References
*To be filled by dev agent*

### Completion Notes List
*To be filled by dev agent*

### File List
*To be filled by dev agent*

## QA Results
*Results from QA Agent review will be populated here after implementation*
