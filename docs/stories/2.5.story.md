# Story 2.5: Student XP System and Activity Recognition

## Status
Draft

## Story
**As a** student,  
**I want** to view XP and get recognition for activity,  
**so that** I can track my learning progress and feel motivated to engage more with the platform

## Acceptance Criteria
1. Student can view their current XP total and progress on their dashboard
2. Student earns XP for various activities (login, assignment submission, material viewing, etc.)
3. Student can see XP breakdown by activity type and course
4. Student receives recognition badges or achievements for milestones
5. Student can view activity history and XP earning timeline
6. XP system integrates with existing student activities seamlessly
7. Student can see leaderboard or ranking within courses (if enabled)
8. XP and achievements are displayed in an engaging, gamified interface

## Tasks / Subtasks

- [ ] Task 1: Create XP and activity tracking data models (AC: 1, 2, 3, 5)
  - [ ] Design XPLog model for tracking activity-based XP earnings
  - [ ] Create ActivityType enum (LOGIN, ASSIGNMENT_SUBMIT, MATERIAL_VIEW, etc.)
  - [ ] Add Achievement model for badges and milestones
  - [ ] Set up Student-XP relationships and aggregations
  - [ ] Add Zod validation schemas for XP and activity data

- [ ] Task 2: Implement XP earning system and APIs (AC: 2, 6)
  - [ ] Create XP earning functions for different activities
  - [ ] Add XP tracking hooks to existing student actions
  - [ ] Create Server Actions for XP queries and calculations
  - [ ] Implement achievement checking and badge awarding
  - [ ] Add error handling and duplicate prevention for XP earning

- [ ] Task 3: Build XP dashboard UI components (AC: 1, 3, 8)
  - [ ] Create XPDashboard component showing total and progress
  - [ ] Build XPBreakdown component for activity type analysis
  - [ ] Create ProgressBar component for XP visualization
  - [ ] Add XPBadges component for achievements display
  - [ ] Style components with engaging gamified design

- [ ] Task 4: Implement activity tracking integration (AC: 2, 6)
  - [ ] Add XP tracking to assignment submission workflow
  - [ ] Integrate XP earning with material viewing
  - [ ] Add XP for login streaks and regular engagement
  - [ ] Create XP earning for course completion milestones
  - [ ] Ensure XP tracking doesn't impact performance

- [ ] Task 5: Create achievement system (AC: 4, 8)
  - [ ] Design achievement criteria and badge system
  - [ ] Implement achievement checking algorithms
  - [ ] Create badge unlocking and notification system
  - [ ] Add achievement showcase and display
  - [ ] Build achievement progress tracking

- [ ] Task 6: Add XP analytics and history features (AC: 3, 5, 7)
  - [ ] Create XP history timeline component
  - [ ] Add course-specific XP breakdown views
  - [ ] Implement leaderboard functionality (optional)
  - [ ] Create XP analytics charts and visualizations
  - [ ] Add activity streaks and consistency tracking

- [ ] Task 7: Integrate XP system into student dashboard (AC: 1, 8)
  - [ ] Add XP widget to main student dashboard
  - [ ] Create dedicated XP page at `/dashboard/student/progress`
  - [ ] Add XP navigation and progress indicators
  - [ ] Implement XP notifications and celebrations
  - [ ] Ensure responsive design for mobile XP viewing

- [ ] Task 8: Test XP system functionality (AC: 1, 2, 3, 4, 5, 6, 7, 8)
  - [ ] Test XP earning for all activity types
  - [ ] Test XP calculation accuracy and aggregation
  - [ ] Test achievement unlocking and badge display
  - [ ] Test XP history and timeline accuracy
  - [ ] Test leaderboard functionality and privacy
  - [ ] Test XP system performance impact
  - [ ] Test gamification UI engagement and responsiveness
  - [ ] Test XP system integration with existing workflows

## Dev Notes

### Previous Story Insights
**Epic 1** established:
- Student authentication and dashboard at `/dashboard/student`
- Role-based access control and session management

**Story 2.1** established:
- Course and Enrollment models with proper relationships
- Student course viewing and access control

**Story 2.2** established:
- Material viewing system with engagement tracking potential
- Course content access patterns

**Story 2.3** established:
- Assignment submission system with completion tracking
- Student activity workflow and submission events

**Story 2.4** established:
- Calendar system with assignment due date tracking
- Student engagement with deadline management

### XP and Gamification Architecture
- **XP System**: Students can view XP and get recognition for activity [Source: prd/07-7-epics-stories.md]
- **Student Features**: XP tracking system based on user activity [Source: prd/06-6-features-by-role.md]
- **Motivational Enhancement**: Quality-of-life enhancements missing from original [Source: prd/01-1-product-summary.md]

### Database Schema Requirements
- **XPLog Model**: New model for tracking XP-earning activities
- **Achievement Model**: Badges and milestone tracking system
- **ActivityType Enum**: LOGIN, ASSIGNMENT_SUBMIT, MATERIAL_VIEW, COURSE_COMPLETE, etc.
- **User Model**: Existing model with XP aggregation relationships
- **ORM**: Prisma for XP queries and activity tracking [Source: architecture/04-database.md]
- **Database**: NeonDB PostgreSQL for XP and activity data [Source: architecture/04-database.md]

### Frontend Architecture Requirements
- **Framework**: Next.js App Router with XP dashboard integration [Source: architecture/01-frontend.md]
- **UI Components**: shadcn/ui components with gamified styling [Source: architecture/01-frontend.md]
- **Styling**: TailwindCSS for engaging XP visualization [Source: architecture/01-frontend.md]
- **Animations**: Framer Motion for XP celebrations and progress [Source: prd/08-8-tech-stack-constraints.md]

### API Implementation Requirements
- **Server Actions**: Next.js Server Actions for XP tracking and queries [Source: architecture/02-backend-logic.md]
- **Validation**: Zod for XP and activity data validation [Source: architecture/02-backend-logic.md]
- **Performance**: Efficient XP aggregation without impacting user workflows

### Data Models Required
```typescript
// New XPLog model
XPLog {
  id, studentId, activityType, xpEarned, courseId?, assignmentId?, materialId?, createdAt
}

// Activity type enum
ActivityType {
  LOGIN, ASSIGNMENT_SUBMIT, MATERIAL_VIEW, COURSE_COMPLETE, LOGIN_STREAK, DEADLINE_MET
}

// New Achievement model
Achievement {
  id, studentId, badgeType, unlockedAt, criteria, progress
}

// Badge type enum
BadgeType {
  FIRST_SUBMISSION, COURSE_EXPLORER, DEADLINE_MASTER, CONSISTENCY_CHAMPION, etc.
}

// Extend User model for XP aggregation
User {
  id, email, role, totalXP: number, xpLogs: XPLog[], achievements: Achievement[]
}
```

### File Locations (Building on Previous Stories)
- XP components: `src/components/student/XPDashboard.tsx`, `src/components/student/XPBadges.tsx`
- XP pages: `src/app/dashboard/student/progress/page.tsx`
- XP APIs: `src/app/dashboard/student/progress/actions.ts`
- XP utilities: `src/lib/xp.ts`, `src/lib/achievements.ts`
- XP tracking hooks: `src/hooks/useXP.ts`

### XP Earning System Design
- **Activity Points**: Different activities award different XP amounts
- **XP Values**: Login (5 XP), Assignment Submit (25 XP), Material View (10 XP), etc.
- **Bonus Multipliers**: Streak bonuses, deadline bonuses, course completion bonuses
- **Anti-Gaming**: Prevent XP farming with cooldowns and duplicate prevention
- **Fair Distribution**: Balanced XP system that rewards genuine engagement

### Achievement System Design
- **Badge Categories**: Academic (assignments), Explorer (materials), Consistency (streaks)
- **Milestone Achievements**: First submission, 10 submissions, course completion
- **Behavioral Achievements**: Login streaks, early submissions, help others
- **Progress Tracking**: Partial progress toward achievements
- **Visual Design**: Engaging badge graphics and unlock animations

### Gamification UI/UX Design
- **Progress Bars**: Visual XP progress with level-like progression
- **XP Celebrations**: Animations and notifications for XP gains
- **Badge Showcase**: Prominent display of earned achievements
- **Leaderboards**: Optional competitive elements (course-based)
- **Activity Feed**: Recent XP-earning activities timeline
- **Mobile Optimized**: Touch-friendly XP interactions

### Integration Points with Existing Stories
- **Login Tracking**: Hook into Epic 1 authentication for login XP
- **Course Activity**: Track course viewing from Story 2.1
- **Material Engagement**: Track material viewing from Story 2.2
- **Assignment Activity**: Track submissions from Story 2.3
- **Calendar Engagement**: Track calendar usage from Story 2.4

### XP Tracking Implementation
- **Non-Intrusive**: XP tracking shouldn't slow down existing workflows
- **Async Processing**: XP calculations happen in background
- **Event-Driven**: Hook into existing events (submit, view, login)
- **Duplicate Prevention**: Ensure activities only award XP once
- **Performance Optimized**: Efficient XP aggregation and queries

### Security and Privacy Considerations
- **XP Integrity**: Prevent XP manipulation and gaming
- **Privacy Controls**: Optional leaderboard participation
- **Data Protection**: Secure storage of activity and XP data
- **Fair Play**: Anti-cheating measures for XP earning
- **Student Control**: Students can view their own XP data securely

### Performance Considerations
- **Efficient Queries**: Optimized XP aggregation and history queries
- **Caching Strategy**: Cache XP totals and achievement status
- **Background Processing**: XP calculations don't block user actions
- **Database Optimization**: Proper indexing for XP and activity queries
- **Real-time Updates**: Live XP updates without performance impact

### Business Rules and XP Values
- **Login**: 5 XP (once per day)
- **Assignment Submission**: 25 XP (per submission)
- **Material Viewing**: 10 XP (per unique material)
- **Course Completion**: 100 XP bonus
- **Login Streak**: 5 XP bonus per consecutive day
- **Early Submission**: 10 XP bonus (submitted >24h before deadline)

### Testing Requirements
- **XP Earning Tests**: Verify correct XP amounts for activities
- **Achievement Tests**: Badge unlocking and progress tracking
- **Integration Tests**: XP tracking with existing workflows
- **Performance Tests**: XP system impact on application performance
- **Security Tests**: XP manipulation prevention and data integrity
- **UI Tests**: Gamification interface and user experience
- **Analytics Tests**: XP breakdown and history accuracy

### Project Structure Notes
Building on complete Epic 2 foundation:
- All student activity workflows established in previous stories
- Authentication and dashboard system from Epic 1
- Need to add XP and Achievement models to database
- Need to create gamified UI components and progress tracking
- Need to integrate XP tracking hooks into existing workflows

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-07-23 | 1.0 | Initial story creation | Scrum Master (Bob) |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

### Agent Model Used
*To be filled by dev agent*

### Debug Log References  
*To be filled by dev agent*

### Completion Notes List
*To be filled by dev agent*

### File List
*To be filled by dev agent*

## QA Results
*Results from QA Agent QA review of the completed story implementation*
