# Story 3.2: Lecturer Material Upload and Management

## Status
Draft

## Story
**As a** lecturer,  
**I want** to upload materials to a course,  
**so that** I can provide students with learning resources, documents, and supplementary content

## Acceptance Criteria
1. Lecturer can upload files (PDF, DOC, PPT, images) to their courses
2. Lecturer can organize materials into folders or categories within courses
3. Lecturer can edit material titles, descriptions, and visibility settings
4. Lecturer can delete materials they uploaded
5. Lecturer can set material availability dates (publish now or schedule)
6. Lecturer can preview uploaded materials before publishing
7. Only course-owning lecturers can upload materials to their courses
8. Students can access published materials through their course view
9. Material uploads support drag-and-drop and bulk uploads
10. Lecturer sees file size limits and supported format warnings

## Tasks / Subtasks

- [ ] Task 1: Extend Material model for lecturer upload management (AC: 1, 4, 5, 7)
  - [ ] Add uploadedBy field to Material model linking to lecturer
  - [ ] Add visibility and scheduling fields (publishedAt, availableFrom, availableTo)
  - [ ] Add file metadata fields (originalName, fileSize, mimeType, uploadPath)
  - [ ] Update Material model with organization fields (folder, category)
  - [ ] Add proper foreign key relationships for lecturer-material ownership

- [ ] Task 2: Implement file upload infrastructure (AC: 1, 9, 10)
  - [ ] Set up file storage solution (local storage or cloud storage)
  - [ ] Create file upload API endpoint with size and type validation
  - [ ] Implement file type checking for supported formats
  - [ ] Add file size limit enforcement (e.g., 50MB per file)
  - [ ] Create secure file serving endpoint for authenticated access

- [ ] Task 3: Build material upload Server Actions (AC: 1, 3, 4, 5, 7)
  - [ ] Create Server Action for material upload with course validation
  - [ ] Add Server Action for material editing and metadata updates
  - [ ] Implement material deletion with file cleanup
  - [ ] Add material visibility and scheduling controls
  - [ ] Create lecturer ownership verification for all material operations

- [ ] Task 4: Create material upload UI components (AC: 1, 2, 9, 10)
  - [ ] Build MaterialUploadForm with drag-and-drop functionality
  - [ ] Create FileDropzone component with visual feedback
  - [ ] Add BulkUploadInterface for multiple file uploads
  - [ ] Implement upload progress indicators and error handling
  - [ ] Add file format and size limit warnings

- [ ] Task 5: Build material organization and management UI (AC: 2, 3, 5, 6)
  - [ ] Create MaterialFolderView for organizing course materials
  - [ ] Build MaterialEditForm for title, description, and settings
  - [ ] Add MaterialPreview component for viewing uploaded files
  - [ ] Implement material visibility and scheduling controls
  - [ ] Create material list view with sorting and filtering

- [ ] Task 6: Integrate material management into course pages (AC: 3, 4, 7, 8)
  - [ ] Add materials tab to lecturer course detail page
  - [ ] Create material management section in `/dashboard/lecturer/courses/[id]`
  - [ ] Implement material upload within course context
  - [ ] Add material organization tools within course management
  - [ ] Connect lecturer material uploads to student material access

- [ ] Task 7: Implement material scheduling and visibility (AC: 5, 6, 8)
  - [ ] Add material publishing controls (draft, published, scheduled)
  - [ ] Implement material availability date scheduling
  - [ ] Create material preview functionality for lecturers
  - [ ] Add visibility indicators for material status
  - [ ] Implement automatic material publishing based on schedule

- [ ] Task 8: Test material upload and management system (AC: 1, 2, 3, 4, 5, 6, 7, 8, 9, 10)
  - [ ] Test file upload with various supported formats
  - [ ] Test file size limits and format validation
  - [ ] Test drag-and-drop and bulk upload functionality
  - [ ] Test material organization and folder management
  - [ ] Test material editing and visibility controls
  - [ ] Test material scheduling and availability dates
  - [ ] Test material deletion and file cleanup
  - [ ] Test lecturer ownership and access control
  - [ ] Test student access to published materials
  - [ ] Test material preview and management interface

## Dev Notes

### Previous Story Insights
**Story 3.1** established:
- Lecturer course ownership and management system
- Course creation and editing with lecturer authentication
- Foundation course management UI at `/dashboard/lecturer/courses`
- Lecturer role verification and authorization patterns

**Epic 2** established:
- Material model for course content delivery
- Student material access through course enrollment
- Material viewing interface for students
- Course-Material relationships

### Material Upload Architecture
- **Lecturer Tools**: Upload materials to course [Source: prd/07-7-epics-stories.md]
- **Course Materials**: Lecturers can upload materials to courses [Source: prd/06-6-features-by-role.md]
- **Material Management**: Upload, organize, and schedule course materials
- **Student Access**: Materials appear in student course views automatically

### File Upload Infrastructure Requirements
- **File Storage**: Secure file storage with proper access controls
- **File Validation**: Support PDF, DOC, DOCX, PPT, PPTX, images (JPG, PNG, GIF)
- **File Limits**: 50MB per file, total course storage limits
- **File Security**: Authenticated access only, lecturer ownership verification
- **File Cleanup**: Proper file deletion when materials are removed

### Database Schema Requirements
- **Material Model Extension**: Add lecturer ownership and file metadata
- **File Metadata**: originalName, fileName, fileSize, mimeType, uploadPath
- **Scheduling Fields**: publishedAt, availableFrom, availableTo for material availability
- **Organization Fields**: folder, category, sortOrder for material organization
- **ORM**: Prisma for material and file operations [Source: architecture/04-database.md]
- **Database**: NeonDB PostgreSQL for material metadata storage [Source: architecture/04-database.md]

### Frontend Architecture Requirements
- **Framework**: Next.js App Router with file upload capabilities [Source: architecture/01-frontend.md]
- **UI Components**: shadcn/ui components for upload interface [Source: architecture/01-frontend.md]
- **File Upload**: Drag-and-drop interface with progress indicators
- **Material Management**: Integration with existing lecturer course pages
- **Styling**: TailwindCSS for responsive material management interface [Source: architecture/01-frontend.md]

### API Implementation Requirements
- **File Upload API**: Secure file upload endpoint with validation
- **Server Actions**: Next.js Server Actions for material CRUD operations [Source: architecture/02-backend-logic.md]
- **Validation**: Zod for material metadata and file validation [Source: architecture/02-backend-logic.md]
- **Authorization**: Lecturer course ownership verification for uploads

### Data Models Extension
```typescript
// Extend existing Material model
Material {
  id, title, description, type, filePath, courseId, uploadedBy, createdAt, updatedAt,
  originalName, fileName, fileSize, mimeType, uploadPath,
  publishedAt, availableFrom, availableTo, visibility,
  folder, category, sortOrder,
  course: Course, uploader: User
}

// Material visibility enum
MaterialVisibility {
  DRAFT, PUBLISHED, SCHEDULED, ARCHIVED
}

// Material type enum (extend existing)
MaterialType {
  DOCUMENT, PRESENTATION, IMAGE, VIDEO, OTHER
}

// Upload configuration
UploadConfig {
  maxFileSize: 50MB,
  supportedTypes: ['pdf', 'doc', 'docx', 'ppt', 'pptx', 'jpg', 'png', 'gif'],
  maxFilesPerCourse: 500
}
```

### File Locations (Building on Previous Stories)
- Material upload components: `src/components/lecturer/MaterialUploadForm.tsx`, `src/components/lecturer/FileDropzone.tsx`
- Material management: `src/components/lecturer/MaterialList.tsx`, `src/components/lecturer/MaterialEditForm.tsx`
- Upload API: `src/app/api/upload/materials/route.ts`
- Material actions: `src/app/dashboard/lecturer/courses/[id]/materials/actions.ts`
- Material pages: `src/app/dashboard/lecturer/courses/[id]/materials/page.tsx`

### Material Upload Workflow
- **Upload Process**: Select course → Upload files → Set metadata → Organize → Publish
- **File Validation**: Check file type and size before upload
- **Metadata Entry**: Title, description, category, availability settings
- **Organization**: Folder structure, categories, sorting within course
- **Publishing**: Draft → Review → Publish or Schedule

### Material Organization System
- **Folder Structure**: Hierarchical organization within courses
- **Categories**: Week-based, topic-based, or custom categorization
- **Sorting**: Manual sorting, date-based, alphabetical options
- **Bulk Operations**: Move, categorize, publish multiple materials
- **Search and Filter**: Find materials within course quickly

### Security and Access Control
- **Lecturer-Only Upload**: Verify lecturer owns course before material upload
- **File Security**: Secure file storage with authenticated access only
- **Course Ownership**: Only course-owning lecturers can upload materials
- **Student Access**: Materials visible to enrolled students when published
- **File Validation**: Sanitize file names and validate file contents

### UI/UX Requirements for Material Upload
- **Drag-and-Drop Interface**: Intuitive file upload with visual feedback
- **Progress Indicators**: Show upload progress and completion status
- **Bulk Upload**: Upload multiple files efficiently
- **Material Preview**: Preview uploaded materials before publishing
- **Organization Tools**: Easy material organization and management
- **Responsive Design**: Works well on desktop and tablet for content management

### Integration Points
- **Course Management**: Extends Story 3.1 course management with materials
- **Student Access**: Materials appear in Epic 2 student course views
- **Authentication**: Uses Epic 1 lecturer authentication and role verification
- **File System**: Secure file storage integrated with application security

### Business Rules
- **Course Ownership**: Only course-owning lecturers can upload materials
- **File Limits**: Enforce file size and type restrictions
- **Material Scheduling**: Support future publication of materials
- **Storage Management**: Track and limit course storage usage
- **Student Visibility**: Materials only visible to enrolled students when published

### Workflow Integration
- **Course Creation**: Course created (3.1) → Materials uploaded (3.2) → Students access
- **Material Lifecycle**: Upload → Organize → Schedule → Publish → Student Access
- **Assignment Integration**: Materials can support assignments from Story 3.1
- **Grading Workflow**: Foundation for grading materials in Story 3.3

### Performance Considerations
- **File Upload**: Efficient file upload with progress tracking
- **Storage Optimization**: Optimize file storage and retrieval
- **Material Loading**: Lazy loading for large material lists
- **Cache Strategy**: Cache material metadata for fast access
- **Bandwidth Management**: Optimize file serving for student access

### Testing Requirements
- **Upload Tests**: File upload with various formats and sizes
- **Validation Tests**: File type and size limit enforcement
- **Organization Tests**: Material organization and folder management
- **Scheduling Tests**: Material availability and publishing controls
- **Access Control Tests**: Lecturer ownership and student access verification
- **UI Tests**: Drag-and-drop interface and material management
- **Integration Tests**: End-to-end material upload to student access workflow
- **Security Tests**: File security and access control validation

### File Storage Strategy
- **Local Development**: Local file storage for development environment
- **Production**: Cloud storage (AWS S3, Cloudinary) for production deployment
- **File Security**: Authenticated file serving with access control
- **File Organization**: Structured file storage by course and lecturer
- **Backup Strategy**: File backup and recovery procedures

### Project Structure Notes
Building on previous stories:
- Course management foundation from Story 3.1
- Material model established in Epic 2
- Need to add lecturer upload capabilities to existing Material model
- Need to create comprehensive material management interface
- Foundation for advanced features like assignment attachments and grading

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-07-23 | 1.0 | Initial story creation | Scrum Master (Bob) |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

### Agent Model Used
*To be filled by dev agent*

### Debug Log References  
*To be filled by dev agent*

### Completion Notes List
*To be filled by dev agent*

### File List
*To be filled by dev agent*

## QA Results
*Results from QA Agent QA review of the completed story implementation*
