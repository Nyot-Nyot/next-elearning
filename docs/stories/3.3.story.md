# Story 3.3: Lecturer Assignment Grading and Feedback

## Status
Draft

## Story
**As a** lecturer,  
**I want** to grade student submissions,  
**so that** I can provide feedback, assess student progress, and maintain academic records

## Acceptance Criteria
1. Lecturer can view all submissions for assignments in their courses
2. Lecturer can open and review individual student submissions
3. Lecturer can assign grades (numerical or letter grades) to submissions
4. Lecturer can provide written feedback comments on submissions
5. Lecturer can mark submissions as graded and return them to students
6. Lecturer can see submission timestamps and late submission indicators
7. Lecturer can bulk grade multiple submissions with similar scores
8. Lecturer can track grading progress and see ungraded submissions
9. Students receive notifications when their submissions are graded
10. Lecturer can edit grades and feedback after initial grading

## Tasks / Subtasks

- [ ] Task 1: Extend Submission model for grading workflow (AC: 3, 4, 5, 6, 10)
  - [ ] Add grade field to Submission model (numerical and letter grade support)
  - [ ] Add feedback field for lecturer comments
  - [ ] Add grading status fields (ungraded, graded, returned)
  - [ ] Add gradedAt timestamp and gradedBy lecturer reference
  - [ ] Add grade history tracking for edit capabilities

- [ ] Task 2: Implement submission grading Server Actions (AC: 3, 4, 5, 10)
  - [ ] Create Server Action for grading individual submissions
  - [ ] Add Server Action for bulk grading operations
  - [ ] Implement grade editing and feedback updates
  - [ ] Add submission status management (graded, returned)
  - [ ] Create lecturer ownership validation for grading operations

- [ ] Task 3: Build submission viewing and grading UI (AC: 1, 2, 6, 8)
  - [ ] Create SubmissionList component showing all course submissions
  - [ ] Build SubmissionViewer for individual submission review
  - [ ] Add GradingInterface with grade input and feedback forms
  - [ ] Implement submission filters (ungraded, graded, late submissions)
  - [ ] Create grading progress indicators and statistics

- [ ] Task 4: Implement assignment grading dashboard (AC: 1, 7, 8)
  - [ ] Build assignment grading overview at `/dashboard/lecturer/courses/[id]/assignments/[assignmentId]/grade`
  - [ ] Create submission grid view with student names and status
  - [ ] Add bulk grading interface for multiple submissions
  - [ ] Implement grading statistics and completion tracking
  - [ ] Create quick action buttons for common grading tasks

- [ ] Task 5: Build individual submission grading interface (AC: 2, 3, 4, 5)
  - [ ] Create submission detail view with student work display
  - [ ] Build grade input interface (numerical/letter grade selection)
  - [ ] Add rich text feedback editor for detailed comments
  - [ ] Implement submission file viewer for document submissions
  - [ ] Create grade submission and return-to-student functionality

- [ ] Task 6: Implement grading workflow and notifications (AC: 5, 9)
  - [ ] Add submission return workflow (graded → returned to student)
  - [ ] Implement student notification system for graded submissions
  - [ ] Create email notifications for returned grades
  - [ ] Add grade history tracking for transparency
  - [ ] Implement grade publishing controls

- [ ] Task 7: Add advanced grading features (AC: 6, 7, 10)
  - [ ] Create late submission detection and indicators
  - [ ] Build bulk grading tools with template feedback
  - [ ] Add grade editing capabilities with audit trail
  - [ ] Implement grading rubrics and criteria
  - [ ] Create grading analytics and class performance overview

- [ ] Task 8: Test grading system comprehensively (AC: 1, 2, 3, 4, 5, 6, 7, 8, 9, 10)
  - [ ] Test submission viewing and filtering
  - [ ] Test individual submission grading workflow
  - [ ] Test bulk grading operations
  - [ ] Test grade editing and feedback updates
  - [ ] Test submission return and student notifications
  - [ ] Test late submission handling
  - [ ] Test lecturer ownership and access control
  - [ ] Test grading progress tracking
  - [ ] Test student grade viewing after return
  - [ ] Test grade history and audit trail

## Dev Notes

### Previous Story Insights
**Story 3.1** established:
- Assignment creation and management with lecturer ownership
- Lecturer course dashboard and assignment organization
- Assignment model with due dates and course relationships

**Story 3.2** established:
- Material upload and management system
- Lecturer course content organization
- File handling and secure access patterns

**Epic 2** established:
- Submission model for student assignment submissions
- Student submission workflow with autosave
- Assignment-submission relationships and student access

### Assignment Grading Architecture
- **Grading Workflow**: View submissions → Grade → Provide feedback → Return to students
- **Grade Management**: Numerical and letter grades with feedback comments
- **Submission Processing**: Handle various submission types and late submissions
- **Student Communication**: Notify students when grades are available

### Database Schema Requirements
- **Submission Model Extension**: Add grading fields to existing Submission model
- **Grade Fields**: grade (numerical), letterGrade, feedback, gradingStatus
- **Grading Metadata**: gradedAt, gradedBy, returnedAt, gradeHistory
- **Status Tracking**: submissionStatus (submitted, graded, returned)
- **ORM**: Prisma for submission and grading operations [Source: architecture/04-database.md]
- **Database**: NeonDB PostgreSQL for grade and feedback storage [Source: architecture/04-database.md]

### Frontend Architecture Requirements
- **Framework**: Next.js App Router with grading dashboard integration [Source: architecture/01-frontend.md]
- **UI Components**: shadcn/ui components for grading interface [Source: architecture/01-frontend.md]
- **Grading Interface**: Professional grading tools with feedback editors
- **Real-time Updates**: Live grading progress and submission status updates
- **Styling**: TailwindCSS for responsive grading interface [Source: architecture/01-frontend.md]

### API Implementation Requirements
- **Server Actions**: Next.js Server Actions for grading operations [Source: architecture/02-backend-logic.md]
- **Validation**: Zod for grade and feedback validation [Source: architecture/02-backend-logic.md]
- **Authorization**: Lecturer course ownership verification for grading
- **Notification System**: Email and in-app notifications for graded submissions

### Data Models Extension
```typescript
// Extend existing Submission model
Submission {
  id, content, filePath, assignmentId, studentId, submittedAt, updatedAt,
  grade, letterGrade, feedback, gradingStatus, gradedAt, gradedBy, returnedAt,
  isLate, gradeHistory,
  assignment: Assignment, student: User, grader: User
}

// Grading status enum
GradingStatus {
  UNGRADED, IN_PROGRESS, GRADED, RETURNED
}

// Grade scale configuration
GradeScale {
  numerical: { min: 0, max: 100 },
  letter: ['A+', 'A', 'A-', 'B+', 'B', 'B-', 'C+', 'C', 'C-', 'D', 'F'],
  passingGrade: 60
}

// Grade history tracking
GradeHistory {
  id, submissionId, previousGrade, newGrade, changedAt, changedBy, reason
}
```

### File Locations (Building on Previous Stories)
- Grading components: `src/components/lecturer/SubmissionList.tsx`, `src/components/lecturer/GradingInterface.tsx`
- Grading pages: `src/app/dashboard/lecturer/courses/[id]/assignments/[assignmentId]/grade/page.tsx`
- Individual grading: `src/app/dashboard/lecturer/courses/[id]/assignments/[assignmentId]/submissions/[submissionId]/page.tsx`
- Grading actions: `src/app/dashboard/lecturer/grading/actions.ts`
- Notification system: `src/lib/notifications/grading-notifications.ts`

### Grading Workflow Design
- **Assignment Overview**: See all submissions for assignment with status indicators
- **Individual Grading**: Open submission → Review content → Assign grade → Add feedback → Return
- **Bulk Grading**: Select multiple submissions → Apply common grade/feedback → Return batch
- **Grade Management**: Edit grades after initial grading with audit trail
- **Student Communication**: Automatic notifications when grades are returned

### Grading Interface Requirements
- **Submission Viewer**: Display student submission content clearly
- **Grade Input**: Intuitive numerical and letter grade selection
- **Feedback Editor**: Rich text editor for detailed feedback comments
- **File Support**: View submission files (documents, images) within grading interface
- **Quick Actions**: Fast grading tools for efficient workflow

### Security and Access Control
- **Lecturer-Only Grading**: Verify lecturer owns course and assignment before grading
- **Submission Access**: Only view submissions for lecturer's own assignments
- **Grade Privacy**: Grades only visible to submission author and grading lecturer
- **Audit Trail**: Track all grade changes with timestamps and reasons
- **Data Validation**: Validate grade ranges and feedback content

### UI/UX Requirements for Grading
- **Efficient Workflow**: Streamlined grading process with minimal clicks
- **Submission Organization**: Clear submission lists with status indicators
- **Grading Tools**: Professional grading interface with feedback capabilities
- **Progress Tracking**: Visual indicators for grading completion
- **Responsive Design**: Works well on desktop and tablet for grading sessions

### Integration Points
- **Assignment System**: Extends Story 3.1 assignment management with grading
- **Submission System**: Uses Epic 2 student submission models and workflows
- **Authentication**: Uses Epic 1 lecturer authentication and role verification
- **Notification System**: Integrates with application notification infrastructure

### Business Rules
- **Grading Authority**: Only assignment-owning lecturers can grade submissions
- **Grade Validation**: Enforce grade ranges and valid letter grades
- **Late Submission Handling**: Mark and handle late submissions appropriately
- **Grade History**: Maintain audit trail for all grade changes
- **Student Privacy**: Grades only visible to relevant student and lecturer

### Workflow Integration
- **Assignment Creation**: Assignment created (3.1) → Students submit (Epic 2) → Lecturer grades (3.3)
- **Grading Lifecycle**: Submission received → Review → Grade → Feedback → Return → Student views
- **XP Integration**: Graded assignments can award XP to students (Epic 2 integration)
- **Course Management**: Grading integrated into overall course management workflow

### Performance Considerations
- **Efficient Queries**: Optimized queries for submission lists and grading data
- **Bulk Operations**: Efficient bulk grading with batch updates
- **File Handling**: Fast submission file viewing and processing
- **Grading Dashboard**: Quick loading of grading statistics and progress
- **Notification Performance**: Efficient notification delivery for graded submissions

### Notification System
- **Grade Notifications**: Email and in-app notifications when grades are returned
- **Notification Preferences**: Student preferences for grade notification methods
- **Batch Notifications**: Efficient notification delivery for bulk grading
- **Notification Content**: Grade, feedback, and assignment details in notifications

### Testing Requirements
- **Grading Workflow Tests**: Complete grading process from submission to return
- **Grade Validation Tests**: Numerical and letter grade validation
- **Feedback Tests**: Feedback creation, editing, and display
- **Bulk Grading Tests**: Multiple submission grading operations
- **Notification Tests**: Grade return notifications and delivery
- **Access Control Tests**: Lecturer ownership and grading permissions
- **Audit Trail Tests**: Grade history tracking and changes
- **UI Tests**: Grading interface usability and responsiveness
- **Integration Tests**: End-to-end grading to student grade viewing

### Grade Analytics and Reporting
- **Class Performance**: Overview of assignment performance across students
- **Grading Statistics**: Average grades, completion rates, grade distribution
- **Late Submission Tracking**: Monitor and report on late submission patterns
- **Grading Progress**: Track lecturer grading completion across assignments
- **Grade Trends**: Historical grade data and student progress tracking

### Project Structure Notes
Building on previous stories:
- Assignment management foundation from Story 3.1
- Submission model established in Epic 2
- Need to extend Submission model with grading capabilities
- Need to create comprehensive grading interface and workflow
- Foundation for advanced features like grade analytics and student progress tracking

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-07-23 | 1.0 | Initial story creation | Scrum Master (Bob) |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

### Agent Model Used
*To be filled by dev agent*

### Debug Log References  
*To be filled by dev agent*

### Completion Notes List
*To be filled by dev agent*

### File List
*To be filled by dev agent*

## QA Results
*Results from QA Agent QA review of the completed story implementation*
