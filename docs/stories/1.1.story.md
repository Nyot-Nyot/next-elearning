# Story 1.1: User Registration and Login with BetterAuth

## Status
Draft

## Story
**As a** user,  
**I want** to register and log in using BetterAuth,  
**so that** I can access my personalized e-learning dashboard based on my role

## Acceptance Criteria
1. User can register with email/password using BetterAuth
2. User can log in with valid credentials  
3. User is redirected to appropriate dashboard based on their role (student/lecturer/admin)
4. Invalid login attempts show appropriate error messages
5. Session is maintained using JWT cookies with middleware protection

## Tasks / Subtasks

- [ ] Task 1: Set up BetterAuth configuration and dependencies (AC: 1, 2)
  - [ ] Install BetterAuth package
  - [ ] Create BetterAuth configuration file
  - [ ] Set up environment variables for auth
  - [ ] Configure database schema for users

- [ ] Task 2: Implement user registration functionality (AC: 1, 4)
  - [ ] Create registration API endpoint using Next.js Server Actions
  - [ ] Implement Zod validation for registration data
  - [ ] Create user registration form component with shadcn/ui
  - [ ] Add email/password validation and error handling
  - [ ] Store new users in NeonDB via Prisma

- [ ] Task 3: Implement user login functionality (AC: 2, 4, 5)
  - [ ] Create login API endpoint using Next.js Server Actions
  - [ ] Implement Zod validation for login credentials
  - [ ] Create login form component with shadcn/ui
  - [ ] Set up JWT session handling with cookies
  - [ ] Add authentication error handling and display

- [ ] Task 4: Implement role-based routing and middleware (AC: 3, 5)
  - [ ] Create `lib/roles.ts` for role mapping and auth guards
  - [ ] Set up Next.js middleware for protected routes
  - [ ] Implement role-based redirect logic after login
  - [ ] Create nested dashboard layouts (`/dashboard/student`, `/dashboard/lecturer`, `/dashboard/admin`)

- [ ] Task 5: Create basic dashboard pages (AC: 3)
  - [ ] Create student dashboard placeholder at `/dashboard/student`
  - [ ] Create lecturer dashboard placeholder at `/dashboard/lecturer`  
  - [ ] Create admin dashboard placeholder at `/dashboard/admin`
  - [ ] Ensure responsive design with TailwindCSS

- [ ] Task 6: Add authentication UI/UX enhancements (AC: 4)
  - [ ] Add loading states during auth operations
  - [ ] Implement proper error message display
  - [ ] Add form validation feedback
  - [ ] Style components with TailwindCSS and shadcn/ui

## Dev Notes

### Previous Story Insights
No previous stories - this is the first story in the project.

### Authentication Architecture
- **Framework**: BetterAuth for authentication [Source: architecture/02-backend-logic.md]
- **Method**: Email/password or magic link authentication [Source: architecture/02-backend-logic.md]
- **Session Management**: JWT via cookies with middleware protection per role [Source: architecture/02-backend-logic.md]
- **Validation**: Zod for input validation [Source: architecture/02-backend-logic.md]

### Database Schema Requirements
- **ORM**: Prisma [Source: architecture/04-database.md]
- **Database**: NeonDB PostgreSQL (free tier) [Source: architecture/04-database.md]
- **Required Schema Domain**: `User` [Source: architecture/04-database.md]
- User table must support role-based access (Student, Lecturer, Administrator) [Source: prd/07-7-epics-stories.md]

### Frontend Architecture Requirements
- **Framework**: Next.js App Router [Source: architecture/01-frontend.md]
- **Styling**: TailwindCSS + shadcn/ui + Framer Motion [Source: architecture/01-frontend.md]
- **Routing**: Nested layouts based on user role (`/dashboard/student`, `/dashboard/lecturer`, etc.) [Source: architecture/01-frontend.md]
- **UI**: Component-based with responsive layout [Source: architecture/01-frontend.md]

### API Implementation Requirements
- **API Style**: Next.js Server Actions + route handlers (REST-like) [Source: architecture/02-backend-logic.md]
- **Validation**: All inputs must use Zod validation [Source: architecture/02-backend-logic.md]

### Role-Based Access Implementation
- **Middleware**: Required for protected routes [Source: architecture/03-authorization-flow.md]
- **Role Mapping**: Implement in `lib/roles.ts` for role mapping and auth guards [Source: architecture/03-authorization-flow.md]
- **Redirects**: Role-based redirects after login [Source: architecture/03-authorization-flow.md]

### File Locations (Based on Current Project Structure)
- Authentication components: `src/components/auth/`
- Auth configuration: `src/lib/auth.ts`
- Role utilities: `src/lib/roles.ts`
- Server actions: `src/app/api/auth/` or colocated with pages
- Dashboard layouts: `src/app/dashboard/[role]/`
- Middleware: `src/middleware.ts`

### Tech Stack Constraints
- **Frontend**: Next.js, TailwindCSS, shadcn/ui, Framer Motion [Source: prd/08-8-tech-stack-constraints.md]
- **Backend**: Prisma, NeonDB PostgreSQL (free tier), Server Actions [Source: prd/08-8-tech-stack-constraints.md]  
- **Auth**: BetterAuth [Source: prd/08-8-tech-stack-constraints.md]
- **Infrastructure**: Vercel (free), GitHub Actions [Source: prd/08-8-tech-stack-constraints.md]

### Testing
No specific testing guidance found in architecture docs. Standard Next.js testing practices should apply.

### Project Structure Notes
Current project has basic Next.js App Router structure in place (`src/app/`). New directories will need to be created for components, lib utilities, and dashboard layouts as outlined in the tasks.

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-07-22 | 1.0 | Initial story creation | Scrum Master (Bob) |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

### Agent Model Used
*To be filled by dev agent*

### Debug Log References  
*To be filled by dev agent*

### Completion Notes List
*To be filled by dev agent*

### File List
*To be filled by dev agent*

## QA Results
*Results from QA Agent QA review of the completed story implementation*