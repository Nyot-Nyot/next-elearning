# Story 2.3: Student Assignment Submission with Autosave

## Status
Draft

## Story
**As a** student,  
**I want** to submit assignments with autosave,  
**so that** I can work on assignments progressively without losing my work and submit them when ready

## Acceptance Criteria
1. Student can view assignments for courses they are enrolled in
2. Student can create and edit assignment submissions with rich text editor
3. Assignment work is automatically saved as drafts while typing (autosave)
4. Student can attach files to assignment submissions
5. Student can submit completed assignments with confirmation
6. Student can view submission status and timestamps
7. Student cannot edit submissions after the deadline has passed
8. Offline work is preserved and synced when connection is restored

## Tasks / Subtasks

- [ ] Task 1: Create assignment data models and database schema (AC: 1, 6, 7)
  - [ ] Design Assignment model in Prisma schema (title, description, dueDate, courseId)
  - [ ] Create Submission model for student assignment work
  - [ ] Add submission status enum (DRAFT, SUBMITTED, LATE)
  - [ ] Set up Course-Assignment and Student-Submission relationships
  - [ ] Add Zod validation schemas for assignment and submission data

- [ ] Task 2: Implement assignment and submission APIs (AC: 1, 5, 6, 7)
  - [ ] Create Server Action to fetch course assignments
  - [ ] Create Server Action for submission creation and updates
  - [ ] Add enrollment verification for assignment access
  - [ ] Implement deadline checking and submission validation
  - [ ] Add error handling and authorization for assignment operations

- [ ] Task 3: Build assignment submission UI components (AC: 2, 3, 4)
  - [ ] Create AssignmentEditor with rich text editor (Tiptap or similar)
  - [ ] Build file attachment component with drag-and-drop
  - [ ] Implement autosave functionality with debouncing
  - [ ] Add submission status indicators and progress tracking
  - [ ] Style components with shadcn/ui and TailwindCSS

- [ ] Task 4: Create assignment pages and routing (AC: 1, 5)
  - [ ] Add assignments page at `/dashboard/student/courses/[id]/assignments`
  - [ ] Create assignment list view showing due dates and status
  - [ ] Add individual assignment page at `/dashboard/student/courses/[id]/assignments/[assignmentId]`
  - [ ] Implement assignment submission interface
  - [ ] Add breadcrumb navigation and proper loading states

- [ ] Task 5: Implement autosave and draft management (AC: 3, 8)
  - [ ] Add debounced autosave functionality (save every 2-3 seconds)
  - [ ] Implement local storage backup for offline work
  - [ ] Create draft recovery and conflict resolution
  - [ ] Add visual indicators for save status (saving/saved/error)
  - [ ] Implement PWA offline submission queue

- [ ] Task 6: Add file attachment and submission features (AC: 4, 5)
  - [ ] Implement secure file upload for assignment attachments
  - [ ] Add file type validation and size limits
  - [ ] Create file preview and removal functionality
  - [ ] Implement final submission with confirmation dialog
  - [ ] Add submission receipt and timestamp tracking

- [ ] Task 7: Implement deadline and submission control (AC: 6, 7)
  - [ ] Add deadline checking and warning notifications
  - [ ] Implement read-only mode after deadline passes
  - [ ] Create submission history and version tracking
  - [ ] Add late submission handling and marking
  - [ ] Implement submission status updates and notifications

- [ ] Task 8: Test assignment submission functionality (AC: 1, 2, 3, 4, 5, 6, 7, 8)
  - [ ] Test assignment viewing for enrolled vs non-enrolled students
  - [ ] Test rich text editing and content preservation
  - [ ] Test autosave functionality and draft recovery
  - [ ] Test file attachment upload and validation
  - [ ] Test submission process and confirmation
  - [ ] Test deadline enforcement and read-only states
  - [ ] Test offline work preservation and sync
  - [ ] Test submission status tracking and history

## Dev Notes

### Previous Story Insights
**Epic 1** established:
- Student authentication and dashboard at `/dashboard/student`
- Role-based access control and session management

**Story 2.1** established:
- Course and Enrollment models with proper relationships
- Student course viewing system with access control
- Course detail page routing structure

**Story 2.2** established:
- Material model and secure file serving capabilities
- Course content access patterns and enrollment verification
- PWA offline features and caching strategies

### Assignment Submission Architecture
- **Assignment Submission**: Students can submit assignments with autosave [Source: prd/07-7-epics-stories.md]
- **Student Features**: Assignment submission with autosave functionality [Source: prd/06-6-features-by-role.md]
- **PWA Requirements**: Offline capability with draft synchronization [Source: prd/04-4-non-functional-requirements-nfrs.md]

### Database Schema Requirements
- **Assignment Model**: New model for course assignments (title, description, dueDate, courseId)
- **Submission Model**: Student assignment submissions with status tracking
- **Course Model**: Existing model from Story 2.1 with assignments relationship
- **Submission Status**: DRAFT, SUBMITTED, LATE enum support
- **ORM**: Prisma for assignment and submission operations [Source: architecture/04-database.md]
- **Database**: NeonDB PostgreSQL for assignment data storage [Source: architecture/04-database.md]

### Frontend Architecture Requirements
- **Framework**: Next.js App Router with dynamic routing for assignments [Source: architecture/01-frontend.md]
- **UI Components**: shadcn/ui components for assignment submission interface [Source: architecture/01-frontend.md]
- **Styling**: TailwindCSS for responsive assignment editor [Source: architecture/01-frontend.md]
- **PWA Features**: Offline capability for draft preservation [Source: prd/04-4-non-functional-requirements-nfrs.md]

### API Implementation Requirements
- **Server Actions**: Next.js Server Actions for assignment and submission operations [Source: architecture/02-backend-logic.md]
- **Validation**: Zod for assignment and submission data validation [Source: architecture/02-backend-logic.md]
- **Authorization**: Student enrollment verification for assignment access

### Data Models Required
```typescript
// New Assignment model
Assignment {
  id, title, description, dueDate, courseId, createdAt, updatedAt
}

// New Submission model
Submission {
  id, content, status, submittedAt, studentId, assignmentId, attachments, createdAt, updatedAt
}

// Submission status enum
SubmissionStatus {
  DRAFT, SUBMITTED, LATE
}

// Extend Course model relationship
Course {
  id, title, assignments: Assignment[]
}
```

### File Locations (Building on Previous Stories)
- Assignment components: `src/components/student/AssignmentEditor.tsx`, `src/components/student/AssignmentList.tsx`
- Assignment pages: `src/app/dashboard/student/courses/[id]/assignments/page.tsx`
- Assignment detail: `src/app/dashboard/student/courses/[id]/assignments/[assignmentId]/page.tsx`
- Assignment APIs: `src/app/dashboard/student/courses/[id]/assignments/actions.ts`
- Autosave utilities: `src/lib/autosave.ts`
- File upload utilities: `src/lib/upload.ts`

### Rich Text Editor Implementation
- **Editor Choice**: Tiptap, Lexical, or similar React-compatible editor
- **Features**: Bold, italic, lists, links, basic formatting
- **Autosave Integration**: Debounced saves every 2-3 seconds
- **Content Storage**: HTML or markdown format in database
- **Offline Support**: Local storage backup for draft content

### File Attachment System
- **Upload Security**: File type validation and size limits
- **Storage**: Secure file storage (could extend material serving from Story 2.2)
- **File Types**: Common assignment formats (PDF, DOC, images, etc.)
- **Preview**: File preview before submission
- **Management**: Add/remove attachments before submission

### Autosave and Draft Management
- **Autosave Frequency**: Every 2-3 seconds when content changes
- **Local Backup**: Browser local storage for offline work
- **Conflict Resolution**: Handle conflicts between local and server drafts
- **Visual Feedback**: Save status indicators (saving/saved/error)
- **Recovery**: Draft recovery on page reload or browser restart

### Security and Access Control
- **Enrollment Verification**: Students only access assignments for enrolled courses
- **Assignment-Course Relationship**: Verify assignment belongs to accessible course
- **Deadline Enforcement**: Server-side deadline checking for submissions
- **Content Sanitization**: Sanitize rich text content for security
- **File Upload Security**: Validate uploaded files and prevent malicious content

### Performance and Offline Features
- **Debounced Autosave**: Optimize server requests with debouncing
- **Local Storage**: Preserve work during network interruptions
- **PWA Queue**: Queue submissions for offline-to-online sync
- **Loading States**: Show progress during file uploads and saves
- **Error Recovery**: Graceful handling of save failures and retries

### UI/UX Requirements
- **Assignment Editor**: Rich text editor with toolbar and formatting
- **File Management**: Drag-and-drop file attachment interface
- **Save Status**: Clear indicators for autosave status
- **Deadline Warnings**: Visual warnings as deadlines approach
- **Submission Flow**: Clear submission process with confirmation
- **Responsive Design**: Works well on mobile devices for assignments

### Integration Points
- **Course System**: Leverages Course model and routing from Stories 2.1/2.2
- **Authentication**: Uses Epic 1 student authentication and role verification
- **File Serving**: Extends secure file serving from Story 2.2
- **Dashboard**: Integrates with student dashboard navigation

### Business Rules
- **Enrollment Required**: Only enrolled students can access course assignments
- **Deadline Enforcement**: Hard deadlines with read-only mode after expiration
- **Draft Preservation**: Work is never lost due to technical issues
- **Submission Finality**: Submitted assignments cannot be edited (until grading)
- **File Limits**: Reasonable file size and type restrictions

### Testing Requirements
- **Access Control Tests**: Verify enrollment-based assignment access
- **Editor Tests**: Rich text editing and content preservation
- **Autosave Tests**: Automatic saving and draft recovery
- **File Upload Tests**: Attachment handling and validation
- **Deadline Tests**: Deadline enforcement and read-only states
- **Offline Tests**: PWA offline work preservation and sync
- **Integration Tests**: End-to-end assignment submission workflow

### Project Structure Notes
Building on previous stories:
- Course routing and access control established
- Student authentication and dashboard from Epic 1
- File serving capabilities from Story 2.2
- Need to add Assignment and Submission models
- Need to create rich text editor and autosave system
- Need to implement secure file upload for attachments

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-07-23 | 1.0 | Initial story creation | Scrum Master (Bob) |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

### Agent Model Used
*To be filled by dev agent*

### Debug Log References  
*To be filled by dev agent*

### Completion Notes List
*To be filled by dev agent*

### File List
*To be filled by dev agent*

## QA Results
*Results from QA Agent QA review of the completed story implementation*
