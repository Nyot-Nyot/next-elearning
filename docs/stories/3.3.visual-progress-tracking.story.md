# Story 3.3: Visual Progress Tracking

## Status
Draft

## Story
**As a** student,
**I want to** see my progress in each course visually,
**so that** I can understand my performance and areas for improvement

## Acceptance Criteria
1. Progress bars show completion percentage for each course
2. Individual assignment grades are displayed
3. Overall GPA or performance metric is calculated
4. Progress history shows improvement over time
5. Gamification elements (XP, streaks) motivate engagement

## Tasks / Subtasks
- [ ] Create course progress visualization (AC: 1)
  - [ ] Build animated progress bars for course completion percentage
  - [ ] Display material completion status (viewed/not viewed)
  - [ ] Add assignment completion indicators with visual feedback
  - [ ] Create milestone markers for major course achievements
  - [ ] Implement progress comparison with class averages (optional)
- [ ] Build assignment grade display system (AC: 2)
  - [ ] Create grade visualization components (charts, cards)
  - [ ] Display individual assignment scores with grade breakdown
  - [ ] Add grade trend analysis and improvement indicators
  - [ ] Implement grade distribution charts for context
  - [ ] Show assignment feedback and comments integration
- [ ] Implement GPA calculation system (AC: 3)
  - [ ] Create GPA calculation algorithms (weighted/unweighted)
  - [ ] Display current semester GPA with visual indicators
  - [ ] Add cumulative GPA tracking across all courses
  - [ ] Create GPA trend visualization over time
  - [ ] Implement GPA goals and target tracking
- [ ] Build progress history tracking (AC: 4)
  - [ ] Create progress timeline with key milestones
  - [ ] Display historical performance data with charts
  - [ ] Add month-over-month progress comparison
  - [ ] Implement progress export functionality (PDF reports)
  - [ ] Create progress sharing features for parents/advisors
- [ ] Add gamification and engagement features (AC: 5)
  - [ ] Create XP (experience points) system for course activities
  - [ ] Implement streak tracking for consistent engagement
  - [ ] Add achievement badges for various accomplishments
  - [ ] Create leaderboards for friendly competition (optional)
  - [ ] Build study motivation widgets and daily goals
- [ ] Optimize progress tracking for free tier (AC: 1, 3, 4)
  - [ ] Implement efficient progress calculation to minimize API calls
  - [ ] Cache progress data with smart invalidation strategies
  - [ ] Create client-side progress calculations where possible
  - [ ] Optimize progress visualizations for mobile performance
  - [ ] Add progressive loading for complex progress charts

## Dev Notes

### Previous Story Context
This story builds on completed stories:
- **Epic 1 (1.1-1.3)**: Authentication and user management
- **Epic 2 (2.1-2.3)**: Course management, materials, and enrollment
- **Story 3.1**: Student dashboard foundation with course access
- **Story 3.2**: Academic calendar with deadline tracking
- **Dependencies**: Requires enrollment data, material viewing tracking, and dashboard integration

### Technical Stack Context - Free Tier Optimized
[Source: docs/prd/technical-stack.md]
- **Frontend**: Next.js, Tailwind CSS (progress animations and charts)
- **Backend**: Supabase (Free Tier - 500MB database, 2GB bandwidth)
- **Database**: PostgreSQL via Supabase for progress tracking and gamification
- **Charts**: Chart.js or Recharts for lightweight progress visualization
- **Hosting**: Vercel (Free Tier)

### Data Models Extension
Extended database schema for progress tracking and gamification:
```sql
-- Student progress tracking
CREATE TABLE student_progress (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  student_id UUID REFERENCES users(id) ON DELETE CASCADE,
  course_id UUID REFERENCES courses(id) ON DELETE CASCADE,
  materials_viewed INTEGER DEFAULT 0,
  materials_total INTEGER DEFAULT 0,
  assignments_completed INTEGER DEFAULT 0,
  assignments_total INTEGER DEFAULT 0,
  current_grade DECIMAL(5,2), -- Current course grade
  completion_percentage DECIMAL(5,2), -- Overall course completion
  last_activity TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),
  UNIQUE(student_id, course_id)
);

-- Material viewing tracking
CREATE TABLE material_views (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  student_id UUID REFERENCES users(id) ON DELETE CASCADE,
  material_id UUID REFERENCES course_materials(id) ON DELETE CASCADE,
  first_viewed_at TIMESTAMP DEFAULT NOW(),
  last_viewed_at TIMESTAMP DEFAULT NOW(),
  view_count INTEGER DEFAULT 1,
  time_spent INTEGER DEFAULT 0, -- Seconds spent viewing
  UNIQUE(student_id, material_id)
);

-- Gamification system
CREATE TABLE student_xp (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  student_id UUID REFERENCES users(id) ON DELETE CASCADE,
  course_id UUID REFERENCES courses(id) ON DELETE CASCADE,
  xp_points INTEGER DEFAULT 0,
  level_number INTEGER DEFAULT 1,
  current_streak INTEGER DEFAULT 0,
  longest_streak INTEGER DEFAULT 0,
  last_activity_date DATE DEFAULT CURRENT_DATE,
  total_activities INTEGER DEFAULT 0,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),
  UNIQUE(student_id, course_id)
);

-- Achievement system
CREATE TABLE achievements (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name VARCHAR(100) NOT NULL,
  description TEXT NOT NULL,
  icon VARCHAR(50), -- Icon identifier
  xp_reward INTEGER DEFAULT 0,
  achievement_type VARCHAR(50), -- 'streak', 'completion', 'grade', 'participation'
  threshold_value INTEGER, -- Required value to unlock
  created_at TIMESTAMP DEFAULT NOW()
);

CREATE TABLE student_achievements (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  student_id UUID REFERENCES users(id) ON DELETE CASCADE,
  achievement_id UUID REFERENCES achievements(id) ON DELETE CASCADE,
  course_id UUID REFERENCES courses(id), -- NULL for global achievements
  earned_at TIMESTAMP DEFAULT NOW(),
  UNIQUE(student_id, achievement_id, course_id)
);

-- Progress history snapshots
CREATE TABLE progress_snapshots (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  student_id UUID REFERENCES users(id) ON DELETE CASCADE,
  course_id UUID REFERENCES courses(id) ON DELETE CASCADE,
  snapshot_date DATE DEFAULT CURRENT_DATE,
  completion_percentage DECIMAL(5,2),
  current_grade DECIMAL(5,2),
  xp_points INTEGER,
  materials_viewed INTEGER,
  assignments_completed INTEGER,
  created_at TIMESTAMP DEFAULT NOW()
);
```

### File Locations
Based on Next.js conventions and progress tracking:
- Progress pages: `pages/progress/` or `app/progress/`
- Student progress: `pages/progress/index.js` or `app/progress/page.js`
- Progress components: `components/progress/ProgressBar.js`, `components/progress/XPWidget.js`
- Chart components: `components/progress/GradeChart.js`, `components/progress/ProgressHistory.js`
- Gamification: `components/gamification/AchievementBadges.js`, `components/gamification/StreakCounter.js`
- Progress utilities: `lib/progressCalculations.js`, `lib/gamification.js`
- Progress hooks: `hooks/useProgress.js`, `hooks/useGamification.js`

### Free Tier Progress Optimization
**Efficient Progress Calculation Strategy:**
```javascript
// Optimized progress tracking for free tier
const ProgressCalculationStrategy = {
  // Batch progress calculations to minimize database calls
  batchCalculation: async (studentId) => {
    // Single query to get all course progress data
    const progressData = await supabase.rpc('calculate_student_progress', {
      student_id: studentId
    });
    return progressData;
  },
  
  // Cache progress data with smart invalidation
  cacheStrategy: {
    progress: 10, // Cache progress for 10 minutes
    grades: 5,    // Cache grades for 5 minutes
    xp: 15,       // Cache XP data for 15 minutes
    achievements: 60 // Cache achievements for 1 hour
  },
  
  // Client-side progress calculations
  clientSideCalculations: {
    completionPercentage: true,
    gradeAverages: true,
    xpLevels: true,
    streakCounting: true
  }
};
```

### Progress Visualization Components
```jsx
// Comprehensive progress visualization system
const ProgressDashboard = () => {
  return (
    <ProgressContainer>
      <OverallProgress />
      <CourseProgressGrid>
        {courses.map(course => (
          <CourseProgressCard key={course.id}>
            <ProgressBar percentage={course.completion} />
            <GradeIndicator grade={course.currentGrade} />
            <XPProgress xp={course.xp} level={course.level} />
            <RecentActivity activities={course.recentActivities} />
          </CourseProgressCard>
        ))}
      </CourseProgressGrid>
      
      <GamificationSection>
        <StreakCounter currentStreak={student.streak} />
        <AchievementBadges achievements={student.achievements} />
        <XPLeaderboard /> {/* Optional friendly competition */}
      </GamificationSection>
      
      <ProgressHistory>
        <ProgressChart data={student.progressHistory} />
        <GradesTrend data={student.gradeHistory} />
      </ProgressHistory>
    </ProgressContainer>
  );
};
```

### Gamification System Design
**XP and Achievement System:**
```javascript
// XP point allocation system
const XPSystem = {
  activities: {
    materialView: 5,        // Points for viewing course materials
    assignmentSubmit: 25,   // Points for submitting assignments
    discussionPost: 10,     // Points for discussion participation
    deadlineMet: 15,        // Bonus for meeting deadlines
    streakDay: 5,           // Daily streak bonus
    courseComplete: 100     // Major milestone completion
  },
  
  levels: {
    calculateLevel: (xp) => Math.floor(xp / 100) + 1,
    getNextLevelXP: (currentXP) => Math.ceil(currentXP / 100) * 100,
    getLevelProgress: (xp) => (xp % 100) / 100
  }
};

// Achievement definitions
const Achievements = [
  {
    id: 'first-assignment',
    name: 'Getting Started',
    description: 'Submit your first assignment',
    icon: 'trophy',
    xpReward: 50,
    type: 'completion',
    threshold: 1
  },
  {
    id: 'week-streak',
    name: 'Week Warrior',
    description: 'Maintain a 7-day activity streak',
    icon: 'fire',
    xpReward: 100,
    type: 'streak',
    threshold: 7
  },
  {
    id: 'grade-master',
    name: 'Grade Master',
    description: 'Achieve 90% or higher in a course',
    icon: 'star',
    xpReward: 200,
    type: 'grade',
    threshold: 90
  }
];
```

### Mobile Progress Design
**Touch-Friendly Progress Features:**
- **Swipe Gestures**: Swipe between different progress views
- **Tap Animations**: Satisfying progress bar animations on tap
- **Responsive Charts**: Charts that adapt to mobile screen sizes
- **Quick Stats**: Essential progress info in compact mobile widgets
- **Achievement Notifications**: Celebratory animations for new achievements

### Performance Optimizations for Free Tier
- **Progress Snapshots**: Daily snapshots to reduce real-time calculations
- **Efficient Queries**: Use database functions for complex calculations
- **Client-Side Caching**: Store frequently accessed progress data
- **Lazy Loading**: Load detailed progress data on demand
- **Optimized Charts**: Lightweight chart libraries with minimal data points

### User Experience Features
- **Visual Feedback**: Satisfying animations for progress updates
- **Goal Setting**: Students can set personal progress goals
- **Progress Sharing**: Share achievements with friends or family
- **Motivational Messages**: Encouraging messages based on progress
- **Customizable Metrics**: Students choose which metrics to display
- **Accessibility**: Screen reader support for all progress indicators

### Security Considerations
- **Privacy Protection**: Progress data only visible to the student
- **Data Accuracy**: Prevent manipulation of progress calculations
- **Achievement Integrity**: Server-side validation for all achievements
- **Comparative Data**: Optional anonymized class averages for context

### Integration with Future Assignment System
**Prepared for Epic 4 Integration:**
```javascript
// Progress tracking structure ready for assignment integration
const ProgressMetrics = {
  assignments: {
    submitted: 0,     // Will integrate with Epic 4 submission system
    graded: 0,        // Will track graded assignments
    avgGrade: 0,      // Average assignment grade
    onTimeSubmissions: 0 // Deadline adherence tracking
  },
  
  engagement: {
    materialViews: 0,    // Course material engagement
    discussionPosts: 0,  // Will integrate with Epic 5 discussions
    calendarChecks: 0,   // Calendar usage from Story 3.2
    dashboardVisits: 0   // Dashboard engagement from Story 3.1
  }
};
```

### Testing Requirements
Progress tracking requires comprehensive testing:
- **Calculation Tests**: Progress percentage and GPA calculations
- **Gamification Tests**: XP allocation, achievement unlocking, streak tracking
- **Performance Tests**: Chart rendering, progress calculation efficiency
- **Visual Tests**: Progress animations, responsive chart behavior
- **Integration Tests**: Cross-system progress data aggregation

## Testing

### Testing Standards
Visual progress tracking testing strategy:
- **Unit Tests**:
  - Progress calculation functions (`lib/progressCalculations.test.js`)
  - XP and achievement logic (`lib/gamification.test.js`)
  - GPA calculation algorithms (`utils/gradeCalculations.test.js`)
- **Component Tests**:
  - Progress bar animations and interactions
  - Chart rendering with various data sets
  - Achievement badge displays and notifications
  - Mobile progress widget responsiveness
- **Integration Tests**:
  - Progress data aggregation from multiple sources (`api/progress.test.js`)
  - Material view tracking and progress updates
  - Real-time progress updates and caching
- **E2E Tests**:
  - Complete progress tracking user journey
  - Gamification system engagement flow
  - Cross-course progress visualization
- **Performance Tests**:
  - Progress calculation efficiency with large datasets
  - Chart rendering performance on mobile devices
  - Cache effectiveness for progress data

Test file locations:
- `__tests__/progress/progressComponents.test.js`
- `__tests__/api/progressApi.test.js`
- `__tests__/e2e/progressTracking.test.js`
- `__tests__/gamification/gamificationSystem.test.js`

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-07-21 | 1.0 | Initial story creation with gamification and mobile optimization | Scrum Master (Bob) |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

### Agent Model Used
*To be filled by dev agent*

### Debug Log References
*To be filled by dev agent*

### Completion Notes List
*To be filled by dev agent*

### File List
*To be filled by dev agent*

## QA Results
*Results from QA Agent review will be populated here after implementation*
